<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title>Bayesian MRI reconstruction with joint uncertainty estimation using diffusion models | Guanxiong Jason Luo</title> <meta name="author" content="Guanxiong Jason Luo"> <meta name="description" content="sampling posterior, Bayesian inference, diffusion models, uncertainty estimation, inverse problem, MR image reconstruction, Monte Carlo, Markov chain"> <meta name="keywords" content="jekyll, jekyll-theme, academic-website, portfolio-website"> <link href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha256-DF7Zhf293AJxJNTmh5zhoYYIMs2oXitRfBjY+9L//AY=" crossorigin="anonymous"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="https://unpkg.com/bootstrap-table@1.21.4/dist/bootstrap-table.min.css"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css" integrity="sha256-HtsXJanqjKTc8vVQjO4YMhiqFoXkfBsjBWcX91T1jr8=" crossorigin="anonymous"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/academicons@1.9.1/css/academicons.min.css" integrity="sha256-i1+4qU2G2860dGGIOJscdC30s9beBXjFfzjWLjBRsBg=" crossorigin="anonymous"> <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jwarby/jekyll-pygments-themes@master/github.css" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="data:image/svg+xml,&lt;svg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20100%20100%22&gt;&lt;text%20y=%22.9em%22%20font-size=%2290%22&gt;%F0%9F%90%86&lt;/text&gt;&lt;/svg&gt;"> <link rel="stylesheet" href="/assets/css/main.css"> <link rel="canonical" href="https://ggluo.github.io/projects/2_project/"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jwarby/jekyll-pygments-themes@master/native.css" media="none" id="highlight_theme_dark"> <script src="/assets/js/theme.js"></script> <script src="/assets/js/dark_mode.js"></script> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/">Guanxiong Luo</a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">About</a> </li> <li class="nav-item "> <a class="nav-link" href="/projects/">Projects</a> </li> <li class="nav-item "> <a class="nav-link" href="/publications/">Publications</a> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="fa-solid fa-moon"></i> <i class="fa-solid fa-sun"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5"> <div class="post"> <header class="post-header"> <h1 class="post-title">Bayesian MRI reconstruction with joint uncertainty estimation using diffusion models</h1> <p class="post-description">sampling posterior, Bayesian inference, diffusion models, uncertainty estimation, inverse problem, MR image reconstruction, Monte Carlo, Markov chain</p> </header> <article> <div style="float: right; margin-left: 1rem; margin-bottom: 0rem"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 1000px)" srcset="/assets/img/projects/sampling_posterior/overview-1000.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1200px)" srcset="/assets/img/projects/sampling_posterior/overview-1200.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/projects/sampling_posterior/overview-1400.webp"></source> <img src="/assets/img/projects/sampling_posterior/overview.png" class="img-fluid rounded z-depth-1" width="400" height="auto" title="overview" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> <div class="caption_post"> Figure 1. Overview of the proposed method. </div> </div> <p><strong><code class="language-plaintext highlighter-rouge">Abstract</code></strong> In recent years, the application of deep learning has made significant advancements in fast MRI reconstruction, yielding promising results. However, worries about the uncertainty caused by undersampling strategies and algorithms have limited their usage in clinical practice until now, which could lead to hallucinations. Therefore, the uncertainty assessment constitutes an important step for deep learning-based approaches. The uncertainty is twofold: (1) the uncertainty of weights inside the neural network; and (2) the uncertainty introduced by the missing k-space data points. The uncertainty from missing k-space data points can be addressed in a Bayesian imaging framework.</p> <p><strong><code class="language-plaintext highlighter-rouge">TLDR</code></strong> All in all, a deep learning-based method has enough capability to generate a realistic-looking image even when the problem is highly underdetermined as a result of undersampling, but the uncertainties inside it cannot be ignored.</p> <div style="float: right;margin-right: 0rem; margin-left: 1rem; margin-bottom: 0rem; width: auto; "> <figure> <video src="/assets/img/projects/sampling_posterior/r_samples.mp4" class="img-fluid rounded z-depth-1" width="auto" height="auto" autoplay="" controls="" muted=""></video> </figure> <div class="caption_post" style="margin-bottom: 0.3rem; margin-top: -0.5rem"> Figure 2. Visualization of the samples. </div> </div> <p>Samples are drawn from the posterior distribution given the k-space using the Markov chain Monte Carlo (MCMC) method. The minimum mean square error (MMSE) and maximum a posterior (MAP) estimates are computed. The chains are the reverse of a diffusion process (c.f., Figure 1). Score-based generative models are used to construct chains and are learned from an image database. The unknown data distribution \(q(x_0)\) of the training images goes through repeated Gaussian diffusion and finally reaches a known Gaussian distribution \(q(x_N)\), and this process is reversed by learned transition kernels \(p_\theta(x_{i-1}|x_i)\). To simulate samples from the posterior of the image given the <a href="https://en.wikipedia.org/wiki/K-space_(magnetic_resonance_imaging)" rel="external nofollow noopener" target="_blank">k-space</a>, \(y\), a new Markov chain is constructed by incorporating the measurement model into the reverse process (red chain).</p> <p><strong><code class="language-plaintext highlighter-rouge">Highlight</code></strong> In Figure 3, reconstructions are \(\ell_1\)-ESPIRiT, XPDNet, \(x_\text{MMSE}\) highlighted with confidence interval (CI), \(x_\text{MMSE}\) and a fully-sampled coil-combined image (CoilComb). All methods provide nearly aliasing-free reconstruction at four- or eightfold acceleration. Hallucinations appear when using 8-fold acceleration and are highlighted with CI after thresholding. Selected regions of interests are presented in a zoomed view.</p> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 1000px)" srcset="/assets/img/projects/sampling_posterior/fusion-1000.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1200px)" srcset="/assets/img/projects/sampling_posterior/fusion-1200.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/projects/sampling_posterior/fusion-1400.webp"></source> <img src="/assets/img/projects/sampling_posterior/fusion.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" title="highlight hallucinations with the uncertainty map" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> <div class="caption_post" style="margin-bottom: 1.15rem"> Figure 3. See if you can find hallucinations above. </div> </div> <p><strong><code class="language-plaintext highlighter-rouge">Theory</code></strong> Using Bayes’ formula one obtains for each \(i\) the desired distribution \(p\left (x_i \mid y\right )\) from \begin{equation} p\left(x_i \mid y\right) \propto p\left(x_i\right) p\left(y \mid x_i\right)\quad \text{with}\quad p(y|x_i) = \mathcal{CN}\left(y;\mathcal{A} x_i, {\sigma}^2_{\eta} {I}\right), \nonumber \end{equation} where \(\mathcal{A}\) is the parallel MRI forward model, \(x_i\) is the \(i\)-th image and \(y\) is given k-space data (c.f. Figure 1). Starting with the initial density \(q(x_N)\sim \mathcal{CN}(0,I)\) at \(i=N\), one obtains \(p(x_i)\) with transition kernels \(\{p(x_j | x_{j+1})\}_{i \leq j &lt; N}\) \begin{equation} p(x_i) \propto p(x_i | x_{i+1}) \cdot … \cdot p(x_{N-1} | x_N) \cdot q(x_N).\nonumber \end{equation} By estimating the transition kernel with the neural network, one obtains the kernel \(p_\theta(x_i \mid x_{i+1})\) and therefore one can sample \(p_\theta(x_i | y)\) with the unadjusted Langevin Monte Carlo method in order to get an estimate of \(x_i\), i.e. \begin{equation} x_i^{k+1} \leftarrow x_i^{k} + \frac{\gamma}{2}\nabla_{x_i}\log p_\theta(x_{i}^{k}\mid y) + \sqrt{\gamma}{z},\quad z \sim \mathcal{CN}(0, {I}),\nonumber \end{equation} with stepsize \(\gamma &gt; 0\), \(k=1,...,K\) and \(x_i^1 := x^K_{i+1}\) with \(x_N^1 \sim \mathcal{CN}(0, {I})\).</p> <p><strong><code class="language-plaintext highlighter-rouge">MMSE vs MAP</code></strong> 200 extended iterations after random exploration (i.e, without noise disturbance) and a deterministic estimate of MAP are indicated by solid and dashed lines respectively. (a) PSNR and SSIM over iterations. (b) Variance\(_\text{1}\) and variance\(_\text{2}\) were computed from unextended samples and extended samples respectively. Extended samples converge to \(x_\text{MAP}\).</p> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 1000px)" srcset="/assets/img/projects/sampling_posterior/map_end-1000.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1200px)" srcset="/assets/img/projects/sampling_posterior/map_end-1200.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/projects/sampling_posterior/map_end-1400.webp"></source> <img src="/assets/img/projects/sampling_posterior/map_end.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" title="MMSE vs MAP" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> <div class="caption_post" style="margin-bottom: 1.15rem"> Figure 4. Have a look at two variance maps. </div> </div> <p><strong><code class="language-plaintext highlighter-rouge">Conclusion</code></strong> All in all, a deep learning-based method has enough capability to generate a realistic-looking image even when the problem is highly underdetermined as a result of undersampling, but the uncertainties inside it cannot be ignored.</p> </article> <h2>References</h2> <div class="publications"> <h2 class="bibliography">2023</h2> <ol class="bibliography"><li> <div class="row"> <div class="col-sm-2 abbr"> <abbr class="badge">MRM</abbr><br> <span class="badge"><span style="color:rgb(85, 151, 113)">Oral</span></span> </div> <div id="Luo_Magn.Reson.Med._2023" class="col-sm-8"> <div class="title">Bayesian MRI reconstruction with joint uncertainty estimation using diffusion models</div> <div class="author"> <em>Guanxiong Luo</em>, Moritz Blumenthal, Martin Heide, and Martin Uecker</div> <div class="periodical"> <em>Magn. Reson. Med.</em>, Aug 2023 </div> <div class="periodical"> </div> <div class="links"> <a class="abstract btn btn-sm z-depth-0" role="button">Abs</a> <a href="/assets/pdf/Luo_Magn.Reson.Med._2023.pdf" class="btn btn-sm z-depth-0" role="button">PDF</a> <a href="https://github.com/mrirecon/spreco" class="btn btn-sm z-depth-0" role="button" rel="external nofollow noopener" target="_blank">Code</a> </div> <div class="badges"> </div> <div class="abstract hidden"> <p>Purpose We introduce a framework that enables efficient sampling from learned probability distributions for MRI reconstruction. Method Samples are drawn from the posterior distribution given the measured k-space using the Markov chain Monte Carlo (MCMC) method, different from conventional deep learning-based MRI reconstruction techniques. In addition to the maximum a posteriori estimate for the image, which can be obtained by maximizing the log-likelihood indirectly or directly, the minimum mean square error estimate and uncertainty maps can also be computed from those drawn samples. The data-driven Markov chains are constructed with the score-based generative model learned from a given image database and are independent of the forward operator that is used to model the k-space measurement. Results We numerically investigate the framework from these perspectives: (1) the interpretation of the uncertainty of the image reconstructed from undersampled k-space; (2) the effect of the number of noise scales used to train the generative models; (3) using a burn-in phase in MCMC sampling to reduce computation; (4) the comparison to conventional L1-wavelet regularized reconstruction; (5) the transferability of learned information; and (6) the comparison to fastMRI challenge. Conclusion A framework is described that connects the diffusion process and advanced generative models with Markov chains. We demonstrate its flexibility in terms of contrasts and sampling patterns using advanced generative priors and the benefits of also quantifying the uncertainty for every pixel.</p> </div> </div> </div> </li></ol> <h2 class="bibliography">2022</h2> <ol class="bibliography"><li> <div class="row"> <div class="col-sm-2 abbr"> <abbr class="badge">ISMRM</abbr><br> <span class="badge"><span style="color:rgb(85, 151, 113)">Power Pitch</span></span> </div> <div id="Luo__2022_b" class="col-sm-8"> <div class="title">Using data-driven Markov chains for MRI reconstruction with joint uncertainty estimation</div> <div class="author"> <em>Guanxiong Luo</em>, Martin Heide, and Martin Uecker</div> <div class="periodical"> <em>In Proc. Intl. Soc. Mag. Reson. Med.</em>, Aug 2022 </div> <div class="periodical"> </div> <div class="links"> <a href="/assets/pdf/mcmc.pdf" class="btn btn-sm z-depth-0" role="button">PDF</a> </div> <div class="badges"> </div> </div> </div> </li></ol> </div> </div> </div> <footer class="fixed-bottom"> <div class="container mt-0"> © Copyright 2024 Guanxiong Jason Luo. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="external nofollow noopener">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" rel="external nofollow noopener" target="_blank">al-folio</a> theme. Hosted by <a href="https://pages.github.com/" target="_blank" rel="external nofollow noopener">GitHub Pages</a>. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.bundle.min.js" integrity="sha256-fgLAgv7fyCGopR/gBNq2iW3ZKIdqIcyshnUULC4vex8=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@4/imagesloaded.pkgd.min.js"></script> <script defer src="/assets/js/masonry.js" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.0.8/dist/medium-zoom.min.js" integrity="sha256-7PhEpEWEW0XXQ0k6kQrPKwuoIomz8R8IYyuU1Qew4P8=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js"></script> <script defer src="https://unpkg.com/bootstrap-table@1.21.4/dist/bootstrap-table.min.js"></script> <script src="/assets/js/no_defer.js"></script> <script defer src="/assets/js/common.js"></script> <script defer src="/assets/js/copy_code.js" type="text/javascript"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script> <script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script type="text/javascript">function progressBarSetup(){"max"in document.createElement("progress")?(initializeProgressElement(),$(document).on("scroll",function(){progressBar.attr({value:getCurrentScrollPosition()})}),$(window).on("resize",initializeProgressElement)):(resizeProgressBar(),$(document).on("scroll",resizeProgressBar),$(window).on("resize",resizeProgressBar))}function getCurrentScrollPosition(){return $(window).scrollTop()}function initializeProgressElement(){let e=$("#navbar").outerHeight(!0);$("body").css({"padding-top":e}),$("progress-container").css({"padding-top":e}),progressBar.css({top:e}),progressBar.attr({max:getDistanceToScroll(),value:getCurrentScrollPosition()})}function getDistanceToScroll(){return $(document).height()-$(window).height()}function resizeProgressBar(){progressBar.css({width:getWidthPercentage()+"%"})}function getWidthPercentage(){return getCurrentScrollPosition()/getDistanceToScroll()*100}const progressBar=$("#progress");window.onload=function(){setTimeout(progressBarSetup,50)};</script> </body> </html>